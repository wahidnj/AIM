<!doctype html>
<html lang="en" data-layout="twocolumn" data-sidebar="light" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">

<head>
    <%- include('layout/head-back',{
        title: 'CALL DETAILS'}) %>
        <style>
            canvas {
                width: 100%;
                height: 100px;
                background: #f4f4f9;
                margin-top: 20px;
            }
        </style>
</head>

<body>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <%- include('layout/header') %>
        <!-- Vertical Overlay-->
        <div class="vertical-overlay"></div>

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0">Settings</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <div class="col-xl-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title mb-0">General Settings</h4>
                                </div><!-- end card header -->
                                <div class="card-body">
                                    
                                    <div class="live-preview">
                                        <form id="settingForm">
                                            
                                            <div class="row g-3">
                                                <input type="hidden" class="form-control" id="id" value="<%= assistant.id %>">
                                                <div class="col-lg-6">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" id="name" value="<%= assistant.name %>" readonly>
                                                        <label for="name">Active Agent Name</label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-floating">
                                                        <select class="form-select" id="recording" aria-label="Floating label select example" required>
                                                            <option selected value="">Choose...</option>
                                                            <option value="true" <% if (assistant.recording === "true") { %> selected <% } %>>ON</option>
                                                            <option value="false" <% if (assistant.recording === "false") { %> selected <% } %>>OFF</option>
                                                            
                                                        </select>
                                                        <label for="recording">Voice Provider</label>
                                                    </div>
                                                </div>


                                                <div class="col-lg-4">
                                                    <div class="form-floating">
                                                        <select class="form-select" id="backgroundSound" aria-label="Floating label select example" required>
                                                            <option selected value="">Choose...</option>
                                                            <option value="default" <% if (assistant.background_sound === "default") { %> selected <% } %>>DEFAULT</option>
                                                            <option value="office" <% if (assistant.background_sound === "office") { %> selected <% } %>>OFFICE</option>  
                                                            <option value="off" <% if (assistant.background_sound === "off") { %> selected <% } %>>OFF</option>
                                                        </select>
                                                        <label for="backgroundSound">Background Sound</label>
                                                    </div>
                                                </div>

                                                <div class="col-lg-12">
                                                    <div class="text-end">
                                                        <button type="submit" class="btn btn-success">Update</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <!-- end card body -->
                            </div>
                            <!-- end card -->
                        </div>
                        <!-- end col -->
                    </div><!-- end row -->

                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <%- include('layout/footer') %>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- JAVASCRIPT -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            var token = "<%= user.token %>";
            $('#settingForm').on('submit', function(event) {
                event.preventDefault(); // Prevent the form from submitting the traditional way

                // Get form data
                var id = $('#id').val();
                var recording = $('#recording').val();
                var backgroundSound = $('#backgroundSound').val();

                if(id && recording && backgroundSound){
                   // Send data to the server using AJAX
                    $.ajax({
                        url: '/update-setting', // Replace with your actual controller route
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        },
                        data: {
                            recording: recording,
                            backgroundSound: backgroundSound,
                            id: id
                        },
                        success: function(response) {
                            // Handle success (e.g., show a success message, close modal, etc.)
                            alert('Form submitted successfully!');
                        },
                        error: function(error) {
                            // Handle error (e.g., show an error message)
                            alert('An error occurred. Please try again.');
                        }
                    });
                }

            });
        });
    </script>

</body>

</html>